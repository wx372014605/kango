var a=new PopupExtension();var b=a.get_this();a.favorite_page=1;a.content_init=function(){b.get_favorite_goods()};a.bind_event=function(){$("#popup_content_main .haitao_favorite_list .haitao_favorite_img a,#popup_content_main .haitao_favorite_list .haitao_favorite_name a").live('click',function(){var c=$(this).attr('tab_url');if(c){kango.browser.tabs.create({url:c});KangoAPI.closeWindow()};return false});$('#popup_content_main .haitao_favorite_delete i').live('click',function(){var c=$(this);var d=$(this).attr('goods_id');var e={url:PluginConf.get_interface_file('delete_favorite_goods'),method:'POST',async:true,params:{'goods_id':d},contentType:'json'};kango.xhr.send(e,function(f){if(f.status==200&&f.response!=null){var g=f.response;if(g.status==1){b.favorite_page=1;b.get_favorite_goods()}else{alert(g.message)}}else{}});return false});$('#favorite_page_pre').click(function(){b.page_change('pre')});$('#favorite_page_next').click(function(){b.page_change('next')})};a.get_favorite_goods=function(){kango.invokeAsync('kango.storage.getItem','exchange_rate',function(c){var d=c;kango.invokeAsync('kango.storage.getItem','user_id',function(e){var f=e;var g={url:PluginConf.get_interface_file('get_favorite_goods',{'user_id':f,'page':b.favorite_page}),method:'get',async:true,contentType:'json'};kango.xhr.send(g,function(h){if(h.status==200&&h.response!=null){var i=h.response;if(i.status==1){var j=i.attach;var k=j.favorite_list;var l=k.length;var m='<div class="popup_window_tip"><span>您还没有关注的商品！</span></div>';for(var n=0;n<l;n++){m+='<div class="haitao_favorite_list" title="'+k[n].goods_name+'">'+'<div class="haitao_favorite_img">'+'<a href="javascript:;" tab_url="'+k[n].goods_url+'"><img src="'+k[n].goods_img+'"/></a>'+'</div>'+'<div class="haitao_favorite_delete"><i goods_id="'+k[n].goods_id+'"></i></div>'+'<div class="haitao_favorite_info">'+'<div class="haitao_favorite_name"><a href="javascript:;" tab_url="'+k[n].goods_url+'">'+k[n].goods_name+'</a></div>'+'<div class="haitao_favorite_price">$'+(k[n].goods_price/d).toFixed(2)+'(￥'+k[n].goods_price+')<span>来源网站：'+(k[n].site_name?k[n].site_name:'官网首页')+'</span></div>'+'</div>'+'</div>'};$('#popup_content_main').empty().append(m);if(l==0){$('#popup_content_main .popup_window_tip').show()};if(b.favorite_page<=1){$('#favorite_page_pre').hide()}else{$('#favorite_page_pre').show()};if(b.favorite_page>=j.favorite_count){$('#favorite_page_next').hide()}else{$('#favorite_page_next').show()};$('#popup_content_main').scrollTop(0)}}else{var i='<div class="popup_error_tip"><i></i><span>获取关注商品列表失败！</span></div>';$('#popup_content_main').empty().append(message_list)};$('#popup_content_main').removeClass('window_loading')})})})};a.page_change=function(c){if(c=='pre'){b.favorite_page-=1}else if(c=='next'){b.favorite_page+=1};b.get_favorite_goods()};a.init();